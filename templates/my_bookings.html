<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/my_bookings.css') }}">
</head>

<body>
    <div class="dashboard">
        <aside class="sidebar">
            <h2>User Dashboard</h2>
            <nav>
                <a href="{{ url_for('user_dashboard') }}">Dashboard</a>
                <a href="{{ url_for('my_bookings') }}" class="active">My Bookings</a>
                <a href="{{ url_for('user_profile') }}">Profile</a>
                <a href="{{ url_for('logout') }}" class="logout">Logout</a>
            </nav>
        </aside>
        <div class="flash-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>
        <div class="container">
            <div class="page-header">
                <h2>Your Reservations</h2>
                <p>View and manage all your hotel bookings</p>
            </div>

            {% if bookings %}
            <div class="bookings-grid">
                {% for booking in bookings %}
                <div class="booking-card">
                    {% if booking.image_path %}
                    <img src="{{ url_for('static', filename='uploads/rooms/' ~ booking.image_path) }}" alt="Room"
                        class="booking-image">
                    {% else %}
                    <div class="booking-image"></div>
                    {% endif %}

                    <div class="booking-content">
                        <div class="booking-header">
                            <div>
                                <div class="booking-title">Room {{ booking.room_number or 'N/A' }}</div>
                                <div class="booking-id">#{{ booking.booking_id }}</div>
                            </div>
                            <div>
                                {% if booking.booking_status == 'Not_Canceled' %}
                                <span class="status-badge status-confirmed">Confirmed</span>
                                {% elif booking.booking_status == 'Pending_Payment' %}
                                <span class="status-badge status-pending">Pending</span>
                                {% else %}
                                <span class="status-badge status-cancelled">Cancelled</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="booking-details">
                            <div class="detail-row">
                                <span class="detail-label">Room Type:</span>
                                <span class="detail-value">{{ booking.room_type_name or 'N/A' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Meal Plan:</span>
                                <span class="detail-value">{{ booking.meal_plan_name }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Nights:</span>
                                <span class="detail-value">{{ booking.total_nights }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Guests:</span>
                                <span class="detail-value">{{ booking.no_of_adults }} Adults, {{ booking.no_of_children
                                    }} Children</span>
                            </div>
                        </div>

                        <div class="booking-footer">
                            <div>
                                <div class="total-amount">Rs {{ "%.2f"|format(booking.avg_price_per_room *
                                    booking.total_nights) }}</div>
                                <div class="booking-date">Booked on {{ booking.created_at.split()[0] }}</div>
                            </div>
                            {% if booking.booking_status == 'Not_Canceled' %}
                            <form action="{{ url_for('cancel_booking', booking_id=booking.booking_id) }}" method="POST"
                                onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                                <button type="submit" class="btn-cancel">Cancel Booking</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <h3>No Bookings Yet</h3>
                <p>You haven't made any reservations. Start exploring our available rooms!</p>
                <a href="{{ url_for('user_dashboard') }}" class="btn-book">Browse Rooms</a>
            </div>
            {% endif %}
        </div>
    </div>
    <script>
        const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(msg => {
        setTimeout(() => {
            msg.style.transition = "opacity 0.5s ease";
            msg.style.opacity = "0";
            setTimeout(() => msg.remove(), 500);
        }, 3000);
    });
    </script>
</body>

</html>